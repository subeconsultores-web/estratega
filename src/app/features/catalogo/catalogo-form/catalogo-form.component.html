<div class="space-y-6 pt-2 animate-fade-in max-w-4xl mx-auto">
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-2xl font-bold text-txt-primary flex items-center">
                <button (click)="goBack()"
                    class="mr-3 p-2 hover:bg-surface-hover rounded-full transition-colors text-txt-muted hover:text-txt-primary">
                    <lucide-icon name="arrow-left" class="w-5 h-5"></lucide-icon>
                </button>
                {{ isEditMode ? 'Editar Ítem del Catálogo' : 'Nuevo Ítem' }}
            </h1>
            <p class="text-sm text-txt-muted mt-1 ml-12">Registra un nuevo producto, suscripción o servicio profesional.
            </p>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading"
        class="flex flex-col items-center justify-center p-12 bg-surface rounded-xl border border-border">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        <p class="mt-4 text-sm text-txt-muted font-medium">Cargando información comercial...</p>
    </div>

    <!-- Formular-->
    <form *ngIf="!isLoading" [formGroup]="catalogoForm" (ngSubmit)="onSubmit()" class="space-y-6">

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Columna Izquierda: Detalles Básicos -->
            <div class="md:col-span-2 space-y-6">
                <!-- Tarjeta Principal -->
                <div class="bg-surface rounded-xl border border-border p-6 shadow-sm">
                    <h2
                        class="text-lg font-semibold text-txt-primary mb-4 pb-2 border-b border-border flex items-center">
                        <lucide-icon name="package" class="w-5 h-5 mr-2 text-txt-muted"></lucide-icon>
                        Detalles del Ítem
                    </h2>

                    <div class="space-y-4">
                        <!-- Nombre -->
                        <div>
                            <label class="block text-sm font-medium text-txt-secondary mb-1">Nombre Comercial <span
                                    class="text-red-500">*</span></label>
                            <input type="text" formControlName="nombre"
                                class="w-full px-4 py-2 bg-background border border-border rounded-lg text-txt-primary focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all placeholder:text-txt-muted"
                                placeholder="Ej: Licencia ERP Base, Consultoría Horas">
                            <span *ngIf="catalogoForm.get('nombre')?.invalid && catalogoForm.get('nombre')?.touched"
                                class="text-xs text-red-500 mt-1 block">El nombre es requerido (mínimo 3
                                caracteres)</span>
                        </div>

                        <!-- Descripción -->
                        <div>
                            <label class="block text-sm font-medium text-txt-secondary mb-1">Descripción
                                Detallada</label>
                            <textarea formControlName="descripcion" rows="4"
                                class="w-full px-4 py-2 bg-background border border-border rounded-lg text-txt-primary focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all placeholder:text-txt-muted custom-scrollbar"
                                placeholder="Describe las características técnicas o alcances del servicio..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Columna Derecha: Configuración y Costos -->
            <div class="space-y-6">
                <!-- Tarjeta Configuración -->
                <div class="bg-surface rounded-xl border border-border p-6 shadow-sm">
                    <h2
                        class="text-lg font-semibold text-txt-primary mb-4 pb-2 border-b border-border flex items-center">
                        <lucide-icon name="settings-2" class="w-5 h-5 mr-2 text-txt-muted"></lucide-icon>
                        Atributos
                    </h2>

                    <div class="space-y-4">
                        <!-- Tipo Enum -->
                        <div>
                            <label class="block text-sm font-medium text-txt-secondary mb-1">Tipo de Ítem <span
                                    class="text-red-500">*</span></label>
                            <select formControlName="tipo"
                                class="w-full px-3 py-2 bg-background border border-border rounded-lg text-txt-primary focus:ring-2 focus:ring-primary/50 outline-none transition-all">
                                <option value="producto">Producto (Tangible / Licencia)</option>
                                <option value="servicio">Servicio (Intangible / HH)</option>
                            </select>
                        </div>

                        <!-- SKU -->
                        <div>
                            <label class="block text-sm font-medium text-txt-secondary mb-1">SKU / Código</label>
                            <input type="text" formControlName="skuCode"
                                class="w-full px-4 py-2 bg-background border border-border rounded-lg text-txt-primary focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all placeholder:text-txt-muted uppercase"
                                placeholder="PROD-001">
                        </div>

                        <!-- Categoria -->
                        <div>
                            <label class="block text-sm font-medium text-txt-secondary mb-1">Categoría</label>
                            <input type="text" formControlName="categoria"
                                class="w-full px-4 py-2 bg-background border border-border rounded-lg text-txt-primary focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all placeholder:text-txt-muted"
                                placeholder="Ej: Software, Hardware, Asesoría">
                        </div>
                    </div>
                </div>

                <!-- Tarjeta de Pricing -->
                <div class="bg-surface rounded-xl border border-border p-6 shadow-sm">
                    <h2
                        class="text-lg font-semibold text-txt-primary mb-4 pb-2 border-b border-border flex items-center">
                        <lucide-icon name="banknote" class="w-5 h-5 mr-2 text-txt-muted"></lucide-icon>
                        Fijación de Precio
                    </h2>

                    <div class="space-y-4">
                        <!-- Moneda -->
                        <div>
                            <label class="block text-sm font-medium text-txt-secondary mb-1">Moneda Comercial <span
                                    class="text-red-500">*</span></label>
                            <select formControlName="moneda"
                                class="w-full px-3 py-2 bg-background border border-border rounded-lg text-txt-primary focus:ring-2 focus:ring-primary/50 outline-none transition-all">
                                <option value="CLP">Pesos Chilenos (CLP)</option>
                                <option value="UF">Unidad de Fomento (UF)</option>
                                <option value="USD">Dólares Estadounidenses (USD)</option>
                            </select>
                        </div>

                        <!-- Precio -->
                        <div>
                            <label class="block text-sm font-medium text-txt-secondary mb-1">Precio Unitario Base <span
                                    class="text-red-500">*</span></label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-txt-muted sm:text-sm">$</span>
                                </div>
                                <input type="number" formControlName="precioBase" min="0"
                                    class="w-full pl-7 pr-4 py-2 bg-background border border-border rounded-lg text-txt-primary focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all placeholder:text-txt-muted">
                            </div>
                            <span
                                *ngIf="catalogoForm.get('precioBase')?.invalid && catalogoForm.get('precioBase')?.touched"
                                class="text-xs text-red-500 mt-1 block">El precio es requerido</span>
                        </div>

                        <!-- Is Active Switch -->
                        <div class="flex items-center pt-2">
                            <input type="checkbox" formControlName="isActive" id="isActiveCheck"
                                class="w-4 h-4 text-primary bg-background border-border rounded focus:ring-primary/50">
                            <label for="isActiveCheck"
                                class="ml-2 text-sm font-medium text-txt-primary cursor-pointer">Activo en catálogo y
                                visible para Cotizaciones</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="flex justify-end pt-4 border-t border-border gap-4">
            <button type="button" (click)="goBack()"
                class="px-6 py-2 border border-border text-txt-secondary rounded-lg hover:bg-surface-hover transition-colors font-medium">
                Cancelar
            </button>
            <button type="submit" [disabled]="isSaving"
                class="flex items-center px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed">
                <lucide-icon *ngIf="isSaving" name="loader-2" class="w-4 h-4 mr-2 animate-spin"></lucide-icon>
                <lucide-icon *ngIf="!isSaving" name="save" class="w-4 h-4 mr-2"></lucide-icon>
                {{ isSaving ? 'Guardando...' : (isEditMode ? 'Actualizar Ítem' : 'Guardar Ítem') }}
            </button>
        </div>
    </form>
</div>