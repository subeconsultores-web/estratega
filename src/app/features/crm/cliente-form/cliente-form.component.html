<div class="max-w-4xl mx-auto animate-fade-in">
    <!-- Header -->
    <div class="flex items-center space-x-4 mb-6">
        <button routerLink="/crm/clientes"
            class="p-2 rounded-lg text-txt-secondary hover:text-txt-primary hover:bg-surface-hover transition-colors">
            <lucide-icon name="arrow-left" class="w-5 h-5"></lucide-icon>
        </button>
        <div>
            <h1 class="text-2xl font-bold text-txt-primary">{{ isEditing ? 'Editar Cliente' : 'Nuevo Cliente' }}</h1>
            <p class="text-txt-muted text-sm mt-1">Completa la información corporativa y de contacto del cliente.
            </p>
        </div>
    </div>

    <!-- Form Container -->
    <form [formGroup]="clienteForm" (ngSubmit)="save()" class="space-y-6">

        <!-- Info Empresa Card -->
        <div class="bg-surface border border-border rounded-xl shadow-sm p-6 space-y-4">
            <h2 class="text-base font-semibold text-txt-primary mb-2 flex items-center">
                <lucide-icon name="building-2" class="w-4 h-4 mr-2 text-primary"></lucide-icon>
                Información de la Empresa
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Nombre de la Empresa <span
                            class="text-red-500">*</span></label>
                    <input type="text" formControlName="nombreEmpresa"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                    <p *ngIf="clienteForm.get('nombreEmpresa')?.invalid && clienteForm.get('nombreEmpresa')?.touched"
                        class="text-xs text-red-500 mt-1">El nombre es requerido (mínimo 3 caracteres).</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">RUT <span
                            class="text-red-500">*</span></label>
                    <input type="text" formControlName="rut" placeholder="Ej: 76.123.456-7"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                    <p *ngIf="clienteForm.get('rut')?.invalid && clienteForm.get('rut')?.touched"
                        class="text-xs text-red-500 mt-1">El RUT es requerido.</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Giro Comercial <span
                            class="text-red-500">*</span></label>
                    <input type="text" formControlName="giro"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Dirección Registrada</label>
                    <input type="text" formControlName="direccion"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                </div>
            </div>
        </div>

        <!-- Contacto Principal Card -->
        <div formGroupName="contactoPrincipal"
            class="bg-surface border border-border rounded-xl shadow-sm p-6 space-y-4">
            <h2 class="text-base font-semibold text-txt-primary mb-2 flex items-center">
                <lucide-icon name="user" class="w-4 h-4 mr-2 text-accent"></lucide-icon>
                Contacto Principal
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Nombre Completo <span
                            class="text-red-500">*</span></label>
                    <input type="text" formControlName="nombre"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Cargo</label>
                    <input type="text" formControlName="cargo" placeholder="Ej: Gerente General"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Email <span
                            class="text-red-500">*</span></label>
                    <input type="email" formControlName="email"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                    <p *ngIf="clienteForm.get('contactoPrincipal.email')?.invalid && clienteForm.get('contactoPrincipal.email')?.touched"
                        class="text-xs text-red-500 mt-1">Introduce un correo electrónico válido.</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Teléfono Móvil</label>
                    <input type="tel" formControlName="telefono" placeholder="+56 9 "
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                </div>
            </div>
        </div>

        <!-- CRM Config Card -->
        <div class="bg-surface border border-border rounded-xl shadow-sm p-6 space-y-4">
            <h2 class="text-base font-semibold text-txt-primary mb-2 flex items-center">
                <lucide-icon name="sliders" class="w-4 h-4 mr-2 text-purple-500"></lucide-icon>
                Configuración Pipeline
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Estado</label>
                    <select formControlName="estado"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none">
                        <option value="lead">Lead</option>
                        <option value="prospecto">Prospecto Calificado</option>
                        <option value="activo">Cliente Activo</option>
                        <option value="inactivo">Inactivo</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Etapa de Pipeline</label>
                    <input type="text" formControlName="pipelineEtapa"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-txt-secondary mb-1">Fuente Adquisición</label>
                    <select formControlName="fuenteAdquisicion"
                        class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none">
                        <option value="web">Web Organic</option>
                        <option value="referido">Referido</option>
                        <option value="redes">Redes Sociales</option>
                        <option value="evento">Evento en Vivo</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-txt-secondary mb-1">Notas Internas</label>
                <textarea formControlName="notas" rows="3"
                    class="w-full bg-base border border-border text-txt-primary rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors"></textarea>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex items-center justify-end space-x-3 pt-2">
            <button type="button" routerLink="/crm/clientes"
                class="px-4 py-2 text-sm font-medium text-txt-secondary hover:text-txt-primary hover:bg-surface-hover rounded-lg transition-colors">
                Cancelar
            </button>
            <button type="submit" [disabled]="isSaving"
                class="bg-primary text-white px-6 py-2 rounded-lg text-sm font-medium hover:brightness-110 focus:ring-2 focus:ring-primary/50 focus:outline-none transition-all flex items-center disabled:opacity-70">
                <lucide-icon *ngIf="isSaving" name="loader" class="w-4 h-4 mr-2 animate-spin"></lucide-icon>
                <lucide-icon *ngIf="!isSaving" name="save" class="w-4 h-4 mr-2"></lucide-icon>
                {{ isSaving ? 'Guardando...' : 'Guardar Cliente' }}
            </button>
        </div>

    </form>
</div>