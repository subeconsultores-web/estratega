<div class="space-y-6 h-[calc(100vh-8rem)] flex flex-col pt-2 animate-fade-in">
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 shrink-0">
        <div>
            <h1 class="text-2xl font-bold text-txt-primary tracking-tight">Pipeline Comercial</h1>
            <p class="text-txt-muted mt-1">Gestiona el flujo de adquisición visualmente.</p>
        </div>
        <div class="flex items-center space-x-3 bg-surface border border-border px-4 py-2 rounded-lg shadow-sm">
            <div class="text-sm">
                <span class="text-txt-muted mr-2">Valor Total Pipeline:</span>
                <span class="font-bold text-txt-primary">{{ formatCurrency(totalValue) }}</span>
            </div>
        </div>
    </div>

    <!-- Toolbar -->
    <div class="flex items-center justify-between mt-4">
        <button routerLink="/crm/clientes"
            class="p-2 rounded-lg text-txt-secondary hover:text-txt-primary hover:bg-surface-hover transition-colors flex items-center text-sm font-medium">
            <lucide-icon name="list" class="w-4 h-4 mr-2"></lucide-icon>
            Ver en Lista
        </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex-1 flex justify-center items-center">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
    </div>

    <!-- Kanban Board -->
    <div *ngIf="!isLoading" class="flex-1 overflow-x-auto overflow-y-hidden pb-4">
        <div class="flex h-full min-w-[900px] gap-6">

            <!-- Columna LEAD -->
            <div class="flex flex-col w-1/3 min-w-[300px] h-full">
                <div class="flex items-center justify-between px-1 mb-3">
                    <div class="flex items-center">
                        <div class="w-2 h-2 rounded-full bg-blue-500 mr-2"></div>
                        <h3 class="font-semibold text-txt-primary">Leads (Top of Funnel)</h3>
                    </div>
                    <span
                        class="text-xs font-bold bg-surface border border-border px-2 py-0.5 rounded-full text-txt-secondary">{{
                        leads.length }}</span>
                </div>

                <div
                    class="bg-surface-hover/30 border border-border/50 rounded-xl p-3 flex-1 overflow-y-auto space-y-3 custom-scrollbar">
                    <div *ngFor="let client of leads"
                        class="bg-surface border border-border p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow group relative">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold text-txt-primary text-sm truncate pr-4">{{ client.nombreEmpresa }}
                            </h4>
                            <div class="relative group/menu">
                                <button class="text-txt-muted hover:text-txt-primary">
                                    <lucide-icon name="more-horizontal" class="w-4 h-4"></lucide-icon>
                                </button>
                                <!-- Actions menu -->
                                <div
                                    class="absolute right-0 top-full mt-1 w-32 bg-surface border border-border rounded-md shadow-lg opacity-0 invisible group-hover/menu:opacity-100 group-hover/menu:visible transition-all z-10">
                                    <button (click)="moveClient(client, 'prospecto')"
                                        class="w-full text-left px-3 py-2 text-xs hover:bg-surface-hover text-txt-secondary flex items-center">
                                        <lucide-icon name="arrow-right-circle"
                                            class="w-3 h-3 mr-2 text-primary"></lucide-icon> Mover a Prospecto
                                    </button>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-txt-muted break-words">{{ client.contactoPrincipal.nombre }}</p>
                        <div class="mt-3 flex items-center justify-between text-xs">
                            <span
                                class="bg-blue-500/10 text-blue-600 px-2 py-0.5 rounded border border-blue-500/20 font-medium">Lead</span>
                            <span class="font-semibold text-txt-primary">{{ formatCurrency(client.totalHistorico)
                                }}</span>
                        </div>
                    </div>
                    <div *ngIf="leads.length === 0"
                        class="h-24 flex items-center justify-center text-sm text-txt-muted font-medium border-2 border-dashed border-border rounded-lg">
                        Columna Vacía
                    </div>
                </div>
            </div>

            <!-- Columna PROSPECTO -->
            <div class="flex flex-col w-1/3 min-w-[300px] h-full">
                <div class="flex items-center justify-between px-1 mb-3">
                    <div class="flex items-center">
                        <div class="w-2 h-2 rounded-full bg-yellow-500 mr-2"></div>
                        <h3 class="font-semibold text-txt-primary">Prospectos Calificados</h3>
                    </div>
                    <span
                        class="text-xs font-bold bg-surface border border-border px-2 py-0.5 rounded-full text-txt-secondary">{{
                        prospectos.length }}</span>
                </div>

                <div
                    class="bg-surface-hover/30 border border-border/50 rounded-xl p-3 flex-1 overflow-y-auto space-y-3 custom-scrollbar">
                    <div *ngFor="let client of prospectos"
                        class="bg-surface border border-border p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow group relative border-l-2 border-l-yellow-500">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold text-txt-primary text-sm truncate pr-4">{{ client.nombreEmpresa }}
                            </h4>
                            <div class="relative group/menu">
                                <button class="text-txt-muted hover:text-txt-primary">
                                    <lucide-icon name="more-horizontal" class="w-4 h-4"></lucide-icon>
                                </button>
                                <!-- Actions menu -->
                                <div
                                    class="absolute right-0 top-full mt-1 w-32 bg-surface border border-border rounded-md shadow-lg opacity-0 invisible group-hover/menu:opacity-100 group-hover/menu:visible transition-all z-10">
                                    <button (click)="moveClient(client, 'activo')"
                                        class="w-full text-left px-3 py-2 text-xs hover:bg-surface-hover text-txt-secondary flex items-center">
                                        <lucide-icon name="check-circle"
                                            class="w-3 h-3 mr-2 text-green-500"></lucide-icon> Ganar (A Activo)
                                    </button>
                                    <button (click)="moveClient(client, 'lead')"
                                        class="w-full text-left px-3 py-2 text-xs hover:bg-surface-hover text-txt-secondary flex items-center">
                                        <lucide-icon name="arrow-left-circle"
                                            class="w-3 h-3 mr-2 text-txt-muted"></lucide-icon> Volver a Lead
                                    </button>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-txt-muted break-words">{{ client.contactoPrincipal.nombre }}</p>
                        <div class="mt-3 flex items-center justify-between text-xs">
                            <span
                                class="bg-yellow-500/10 text-yellow-600 px-2 py-0.5 rounded border border-yellow-500/20 font-medium">Prospecto</span>
                            <span class="font-semibold text-txt-primary">{{ formatCurrency(client.totalHistorico)
                                }}</span>
                        </div>
                    </div>
                    <div *ngIf="prospectos.length === 0"
                        class="h-24 flex items-center justify-center text-sm text-txt-muted font-medium border-2 border-dashed border-border rounded-lg">
                        Columna Vacía
                    </div>
                </div>
            </div>

            <!-- Columna ACTIVO -->
            <div class="flex flex-col w-1/3 min-w-[300px] h-full">
                <div class="flex items-center justify-between px-1 mb-3">
                    <div class="flex items-center">
                        <div class="w-2 h-2 rounded-full bg-green-500 mr-2"></div>
                        <h3 class="font-semibold text-txt-primary">Clientes Activos</h3>
                    </div>
                    <span
                        class="text-xs font-bold bg-surface border border-border px-2 py-0.5 rounded-full text-txt-secondary">{{
                        activos.length }}</span>
                </div>

                <div
                    class="bg-surface-hover/30 border border-border/50 rounded-xl p-3 flex-1 overflow-y-auto space-y-3 custom-scrollbar">
                    <div *ngFor="let client of activos"
                        class="bg-surface border border-border p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow group relative border-l-2 border-l-green-500">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold text-txt-primary text-sm truncate pr-4">{{ client.nombreEmpresa }}
                            </h4>
                            <div class="relative group/menu">
                                <button class="text-txt-muted hover:text-txt-primary">
                                    <lucide-icon name="more-horizontal" class="w-4 h-4"></lucide-icon>
                                </button>
                                <!-- Actions menu -->
                                <div
                                    class="absolute right-0 top-full mt-1 w-32 bg-surface border border-border rounded-md shadow-lg opacity-0 invisible group-hover/menu:opacity-100 group-hover/menu:visible transition-all z-10">
                                    <button (click)="moveClient(client, 'inactivo')"
                                        class="w-full text-left px-3 py-2 text-xs hover:bg-surface-hover text-txt-secondary flex items-center">
                                        <lucide-icon name="x-circle" class="w-3 h-3 mr-2 text-gray-500"></lucide-icon>
                                        Marcar Inactivo
                                    </button>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-txt-muted break-words">{{ client.contactoPrincipal.nombre }}</p>
                        <div class="mt-3 flex items-center justify-between text-xs">
                            <span
                                class="bg-green-500/10 text-green-600 px-2 py-0.5 rounded border border-green-500/20 font-medium">Activo</span>
                            <span class="font-semibold text-txt-primary">{{ formatCurrency(client.totalHistorico)
                                }}</span>
                        </div>
                    </div>
                    <div *ngIf="activos.length === 0"
                        class="h-24 flex items-center justify-center text-sm text-txt-muted font-medium border-2 border-dashed border-border rounded-lg">
                        Columna Vacía
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>